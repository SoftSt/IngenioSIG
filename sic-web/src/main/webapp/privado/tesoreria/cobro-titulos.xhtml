<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                template="/WEB-INF/templates/default.xhtml"
                xmlns:p="http://primefaces.org/ui">
    <ui:define name="content">
        <h:panelGroup id="grupoCobroDeTitulo">
            <p:panel id="panelListaPredios" rendered="#{cobroTituloBB.esPantallaActual('PANTALLA_LISTADO')}">
                <h:form id="formularioListaPredios">  

                    <p:growl id="growl" showDetail="true" sticky="true" life="800" />
                    <p:messages id="messages" showDetail="true" autoUpdate="true" closable="true" />
                    <p>
                        <h2>
                            <h:outputText styleClass="#{cobroTituloBB.iconoPantalla.textoEtiqueta}"/>
                            <h:outputText value=" #{cobroTituloBB.tituloPantalla.textoEtiqueta}"/>
                        </h2>
                    </p>
                    <p>#{cobroTituloBB.descripcionPantalla.textoEtiqueta}</p>

                    <p:dataTable id="listaFichaCatastral" var="fichaCatastral" widgetVar="listaFichaCatastralTabla"
                                 value="#{cobroTituloBB.listaFichas}" rowKey="#{fichaCatastral.predio.codCatastral}" filteredValue="#{cobroTituloBB.listaFichasFiltradas}"
                                 paginator="true" rows="20" paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" 
                                 rowsPerPageTemplate="10,15,20" 
                                 emptyMessage="No se han encontrado resultados" 
                                 paginatorPosition="bottom">
                        <p:column headerText="Codigo" sortBy="#{fichaCatastral.predio.nomCodigocatastral}" filterBy="#{fichaCatastral.predio.nomCodigocatastral}">
                            <h:outputText value="#{fichaCatastral.predio.nomCodigocatastral}" />
                        </p:column>

                        <p:column headerText="Propietario CI/RUC" sortBy="#{fichaCatastral.contribuyentePropiedad.codCedularuc}" filterBy="#{fichaCatastral.contribuyentePropiedad.codCedularuc}">
                            <h:outputText value="#{fichaCatastral.contribuyentePropiedad.codCedularuc}"/>
                        </p:column>

                        <p:column headerText="Nombre Propietario" sortBy="#{fichaCatastral.contribuyentePropiedad.nomApellidos} #{fichaCatastral.contribuyentePropiedad.nomNombres}" filterBy="#{fichaCatastral.contribuyentePropiedad.nomApellidos} #{fichaCatastral.contribuyentePropiedad.nomNombres}" >
                            <h:outputText value="#{fichaCatastral.contribuyentePropiedad.nomApellidos} #{fichaCatastral.contribuyentePropiedad.nomNombres}"/>
                        </p:column>

                        <p:column headerText="Seleccionar" width="80">
                            <p:commandButton process="listaFichaCatastral" 
                                             actionListener="#{cobroTituloBB.seleccionarTitulosPredio(fichaCatastral.predio.codCatastral)}"
                                             icon="fa fa-angle-double-right"
                                             id="btnSeleccionarTitulo"
                                             update="grupoCobroDeTitulo">
                                <p:ajax update="toolTipSeleccionTitulo" process="@this" /> 
                            </p:commandButton>
                            <p:tooltip id="toolTipSeleccionTitulo" for="btnSeleccionarTitulo" value="Seleccionar título" showEffect="fade" hideEffect="fade" position="bottom"/>
                        </p:column>

                    </p:dataTable>

                </h:form>
            </p:panel>

            <p:panel id="panelListaTitulos" rendered="#{cobroTituloBB.esPantallaActual('PANTALLA_EDICION')}">
                <h:form id="formularioListaTitulos">

                    <p:growl id="growl" showDetail="true"/>
                    <p:messages id="messages" showDetail="true" autoUpdate="true" closable="true"/>
                    <p>
                        <h2>
                            <h:outputText styleClass="#{cobroTituloBB.iconoPantalla.textoEtiqueta}"/>
                            <h:outputText value=" #{cobroTituloBB.tituloPantalla.textoEtiqueta}"/>
                        </h2>
                    </p>
                    <p>#{cobroTituloBB.descripcionPantalla.textoEtiqueta}</p>
                    <p:tooltip />
                    <p:outputPanel id="opListaTitulos">
                        <h:panelGrid>
                            <br/>
                            <div style="font-size:1.2em;font-weight:bold;">Características del Predio</div>
                            <p:separator />
                            <h:panelGrid columns="2" width="100%">
                                <h:panelGrid>
                                    <h:outputLabel for="propietarioActualContr" value="CONTRIBUYENTE:" style="font-weight: bold;"/>
                                    <h:outputText id="propietarioActualContr" value="#{cobroTituloBB.fichaCatastral.contribuyentePropiedad.nomNombres.trim()} #{cobroTituloBB.fichaCatastral.contribuyentePropiedad.nomApellidos.trim()}"/>
                                    <h:outputLabel for="codCedularucContr" value="RUC/CC:" style="font-weight: bold;"/>
                                    <h:outputText id="codCedularucContr" value="#{cobroTituloBB.fichaCatastral.contribuyentePropiedad.codCedularuc}"/>
                                    <h:outputLabel for="txtDireccionContr" value="DIRECCION/DOMICILIO:" style="font-weight: bold;"/>
                                    <h:outputText id="txtDireccionContr" value="#{cobroTituloBB.fichaCatastral.contribuyentePropiedad.txtDireccion}"/>
                                </h:panelGrid>
                                <h:panelGrid>
                                    <h:outputLabel for="nomCodigocatastralPredio" value="CLAVE CATASTRAL:" style="font-weight: bold;"/>
                                    <h:outputText id="nomCodigocatastralPredio" value="#{cobroTituloBB.fichaCatastral.predio.nomCodigocatastral}"/>
                                    <h:outputLabel for="txtBarrioPredio" value="SITIO/BARRIO:" style="font-weight: bold;"/>
                                    <h:outputText id="txtBarrioPredio" value="#{cobroTituloBB.fichaCatastral.predio.stsBarrio}"/>
                                    <h:outputLabel for="txtDireccionPredio" value="CALLE:" style="font-weight: bold;"/>
                                    <h:outputText id="txtDireccionPredio" value="#{cobroTituloBB.fichaCatastral.predio.txtDireccion}"/>
                                </h:panelGrid>
                            </h:panelGrid>

                            <br/>
                            <div style="font-size:1.2em;font-weight:bold;">Lista de títulos</div>
                            <p:separator />
                            <p:dataTable id="listaTitulosRegistrados" var="tituloRegistrado" widgetVar="listaTitulosRegistradosTabla"
                                         value="#{cobroTituloBB.listaTitulosRegistrados}" rowKey="#{tituloRegistrado.codTitulos}" filteredValue="#{cobroTituloBB.listaTitulosRegistradosFiltrados}"
                                         paginator="true" rows="10" paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" 
                                         rowsPerPageTemplate="10,30,50" 
                                         resizableColumns="false"
                                         sortBy="#{tituloRegistrado.codTitulos}"
                                         emptyMessage="No se han encontrado resultados" 
                                         paginatorPosition="bottom">

                                <p:column headerText="Año de emisión" >
                                    <h:outputText value="#{tituloRegistrado.anioEmision()}"/>
                                </p:column>

                                <p:column headerText="Valor Predio ($)" >
                                    <h:outputText value="#{tituloRegistrado.valBaseimponible}">
                                        <f:convertNumber pattern="$ ###,###.00"/>
                                    </h:outputText>
                                </p:column>

                                <p:column headerText="Valor Edific. ($)">
                                    <h:outputText value="#{tituloRegistrado.valConstruccion}">
                                        <f:convertNumber pattern="###,###.00"/>
                                    </h:outputText>
                                </p:column>

                                <p:column headerText="Valor Terr. ($)">
                                    <h:outputText value="#{tituloRegistrado.valValorterreno}">
                                        <f:convertNumber pattern="###,###.00"/>
                                    </h:outputText>
                                </p:column>

                                <p:column headerText="Estado" >
                                    <h:outputText value="#{tituloRegistrado.stsEstado.estadoTitulo}" />
                                </p:column>

                                <p:column>
                                    <p:commandButton id="btnAccionesTitulos" type="button" icon="fa fa-ellipsis-v" />
                                    <p:tieredMenu overlay="true" trigger="btnAccionesTitulos" my="right top" at="right bottom" style="width:200px">
                                        <p:menuitem icon="fa fa-search-plus" value="Comprobante Preliminar" actionListener="#{cobroTituloBB.calcularDescuentosIntereses(tituloRegistrado.codTitulos)}" update="grupoCobroDeTitulo"/>
                                        <p:menuitem icon="fa fa-trash" value="Baja de Título" actionListener="#{cobroTituloBB.eliminarTitulo(tituloRegistrado.codTitulos)}" update="listaTitulosRegistrados"/>
                                    </p:tieredMenu>
                                </p:column>
                            </p:dataTable>

                            <f:facet name="footer">
                                <p:commandButton value="Regresar Selección Predios"
                                                 id="btnRegresarPredios"
                                                 update="grupoCobroDeTitulo"
                                                 icon="fa fa-arrow-left"
                                                 actionListener="#{cobroTituloBB.regresarPaginaAnterior()}"
                                                 style="float:left;">
                                </p:commandButton>
                            </f:facet>

                            <p:dialog header="Resumen del título" widgetVar="dlgResumenTitulos" modal="false" showEffect="fade" hideEffect="fade" resizable="false" closable="true">
                                <h:panelGrid>
                                    <h:panelGrid columns="2">
                                        <h:panelGrid columns="2" style=" padding-left: 10px">
                                            <h:outputLabel for="contribuyente" value="CONTRIBUYENTE: " style="font-weight: bold;"/>
                                            <h:outputText id="contribuyente" value="#{cobroTituloBB.fichaCatastral.contribuyentePropiedad.nomNombres.trim()} #{cobroTituloBB.fichaCatastral.contribuyentePropiedad.nomApellidos.trim()}"/>
                                            <h:outputLabel for="codCedularuc" value="RUC/CC: " style="font-weight: bold;"/>
                                            <h:outputText id="codCedularuc" value="#{cobroTituloBB.fichaCatastral.contribuyentePropiedad.codCedularuc}"/>
                                            <h:outputLabel for="txtDireccionProp" value="DIRECCIÓN/DOMICILIO: " style="font-weight: bold;"/>
                                            <h:outputText id="txtDireccionProp" value="#{cobroTituloBB.fichaCatastral.contribuyentePropiedad.txtDireccion}"/>
                                            <p:separator /><p:separator />
                                            <h:outputLabel value="AVALUO" style="font-size:1em;font-weight:bold;"/><h:outputLabel value="MONTO" style="font-size:1em;font-weight:bold;"/>
                                            <h:outputLabel for="valTerreno" value="Terreno ($):" style="font-weight: bold; font-size: 0.9em;"/>
                                            <h:outputText id="valTerreno" style="font-size: 0.9em;" value="#{cobroTituloBB.tituloActual.valValorterreno}">
                                                <f:convertNumber pattern="###,###.00"/>
                                            </h:outputText>
                                            <h:outputLabel for="valConstruccion" value="Construcción ($):" style="font-weight: bold; font-size: 0.9em;"/>
                                            <h:outputText id="valConstruccion" style="font-size: 0.9em;" value="#{cobroTituloBB.tituloActual.valConstruccion}">
                                                <f:convertNumber pattern="###,###.00"/>
                                            </h:outputText>
                                            <p:separator /><p:separator />  
                                            <h:outputLabel for="valPropiedad" value="Valor Propiedad ($):" style="font-weight: bold;font-size: 0.9em;"/>
                                            <h:outputText id="valPropiedad" style="font-size: 0.9em;" value="#{cobroTituloBB.tituloActual.valBaseimponible}">
                                                <f:convertNumber pattern="###,###.00"/>
                                            </h:outputText>
                                            <h:outputLabel for="valBase" value="Base Imponible ($):" style="font-weight: bold;font-size: 0.9em;"/>
                                            <h:outputText id="valBase" style="font-size: 0.9em;" value="#{cobroTituloBB.tituloActual.valBaseimponible}">
                                                <f:convertNumber pattern="###,###.00"/>
                                            </h:outputText>
                                            <h:outputLabel for="fecEmision" value="Fecha Emisión:" style="font-weight: bold;font-size: 0.9em;"/>
                                            <h:outputText id="fecEmision" style="font-size: 0.9em;" value="#{cobroTituloBB.tituloActual.obtenerFechaEmision()}"/>
                                            <h:outputLabel for="fecRecaudacion" value="Fecha Recaudación:" style="font-weight: bold;font-size: 0.9em;"/>
                                            <h:outputText id="fecRecaudacion" style="font-size: 0.9em;" value="#{cobroTituloBB.tituloActual.obtenerFechaRecaudacion()}"/>
                                        </h:panelGrid>
                                        <h:panelGrid columns="2" style=" padding-left: 10px; padding-right: 10px" >
                                            <h:outputLabel for="nomCodigocatastral" value="CLAVE CATASTRAL: " style="font-weight: bold;"/>
                                            <h:outputText id="nomCodigocatastral" value="#{cobroTituloBB.tituloActual.nomCodigocatastral}"/>
                                            <h:outputLabel for="txtBarrio" value="SITIO/BARRIO: " style="font-weight: bold;"/>
                                            <h:outputText id="txtBarrio" value="#{cobroTituloBB.tituloActual.txtBarrio}"/>
                                            <h:outputLabel for="txtDireccion" value="CALLE: " style="font-weight: bold;"/>
                                            <h:outputText id="txtDireccion" value="#{cobroTituloBB.tituloActual.txtDireccion}"/>
                                            <p:separator /><p:separator />
                                            <h:outputLabel value="RUBROS" style="font-size:1em;font-weight:bold;"/>
                                            <h:outputLabel value="VALORES" style="font-size:1em;font-weight:bold;float: right"/>
                                            <h:outputLabel for="valImpuestoPredial" value="Impuesto Predial ($):" style="font-weight: bold;font-size: 0.9em;"/>
                                            <h:outputText id="valImpuestoPredial" style="float: right;font-size: 0.9em;" value="#{cobroTituloBB.tituloActual.valImpuestopredial}">
                                                <f:convertNumber pattern="###,###.00"/>
                                            </h:outputText>
                                            <h:outputLabel for="servAdmistrativos" value="Servicios Admininistrativos ($):" style="font-weight: bold;font-size: 0.9em;"/>
                                            <h:outputText id="servAdmistrativos" style="float: right;font-size: 0.9em;" value="#{cobroTituloBB.tituloActual.valServiciosadministrativos}">
                                                <f:convertNumber pattern="###,###.00"/>
                                            </h:outputText>
                                            <h:outputLabel for="valNoconstruido" value="Imp. Solar No Eficado ($):" style="font-weight: bold;font-size: 0.9em;"/>
                                            <h:outputText id="valNoconstruido" style="float: right;font-size: 0.9em;" value="#{cobroTituloBB.tituloActual.valNoconstruido}">
                                                <f:convertNumber pattern="###,###.00"/>
                                            </h:outputText>
                                            <h:outputLabel for="valDescuentoExon" value="Descuento/Exoneración ($):" style="font-weight: bold;font-size: 0.9em;"/>
                                            <h:outputText id="valDescuentoExon" style="float: right;font-size: 0.9em;" value="#{cobroTituloBB.tituloActual.valDescuentoExoneracion}">
                                                <f:convertNumber pattern="###,###.00"/>
                                            </h:outputText>
                                            <h:outputLabel for="valObsoleto" value="Construcción Obsoleta ($):" style="font-weight: bold;font-size: 0.9em;"/>
                                            <h:outputText id="valObsoleto" style="float: right;font-size: 0.9em;" value="#{cobroTituloBB.tituloActual.valSaludpublica}">
                                                <f:convertNumber pattern="###,###.00"/>
                                            </h:outputText>
                                            <h:outputLabel for="valBomberos" value="Bomberos. ($):" style="font-weight: bold;font-size: 0.9em;"/>
                                            <h:outputText id="valBomberos" style="float: right;font-size: 0.9em;" value="#{cobroTituloBB.tituloActual.valBomberos}">
                                                <f:convertNumber pattern="###,###.00"/>
                                            </h:outputText>
                                            <p:separator /><p:separator />
                                        </h:panelGrid>
                                        <h:panelGrid style=" padding-left: 20px"></h:panelGrid>
                                        <h:panelGrid columns="2" width="100%" style=" padding-left: 10px; padding-right: 10px">
                                            <h:outputLabel for="valEmitido" value="Valor Emitido:" style="font-weight: bold;font-size: 0.9em;"/>
                                            <h:outputText id="valEmitido" style="float: right;font-size: 0.9em;" value="#{cobroTituloBB.tituloActual.valTotalapagar}">
                                                <f:convertNumber pattern="###,###.00"/>
                                            </h:outputText>
                                            <h:outputLabel for="valDescuento" value="Descuento/Recargo:" style="font-weight: bold;font-size: 0.9em;"/>
                                            <h:outputText id="valDescuento" style="float: right;font-size: 0.9em;" value="#{cobroTituloBB.tituloActual.valDescuentoaplicado}">
                                                <f:convertNumber pattern="###,###.00"/>
                                            </h:outputText>
                                            <h:outputLabel for="valIntereses" value="Intereses:" style="font-weight: bold;font-size: 0.9em;"/>
                                            <h:outputText id="valIntereses" style="float: right;font-size: 0.9em;" value="#{cobroTituloBB.tituloActual.valInteresaplicado}">
                                                <f:convertNumber pattern="###,###.00"/>
                                            </h:outputText>
                                            <p:separator /><p:separator />
                                            <h:outputLabel for="valAPagar" value="TOTAL A PAGAR:" style="font-weight: bold;font-size: 1em;"/>
                                            <h:outputText id="valAPagar" style="float: right;" value="#{cobroTituloBB.tituloActual.valPagado}">
                                                <f:convertNumber pattern="###,###.00"/>
                                            </h:outputText>	
                                        </h:panelGrid>
                                    </h:panelGrid>
                                    <f:facet name="footer">
                                        <p:commandButton actionListener="#{cobroTituloBB.cobrarTitulo()}"
                                                         icon="fa fa-credit-card"
                                                         value="Efectuar Pago"
                                                         type="submit"
                                                         style="float: right;"
                                                         disabled="#{!cobroTituloBB.tituloActual.esTituloPorCobrar()}"
                                                         id="btnCancelarTitulo"
                                                         update="grupoCobroDeTitulo">
                                        </p:commandButton>
                                        <p:commandButton icon="fa fa-print" 
                                                         value="Imprimir reporte" 
                                                         ajax="false" 
                                                         style="float: left"
                                                         disabled="#{cobroTituloBB.tituloActual.esTituloPorCobrar()}"
                                                         update="grupoGestionTitulo" 
                                                         onclick="PrimeFaces.monitorDownload(start, stop);">

                                            <p:fileDownload value="#{cobroTituloBB.imprimir('TITULO_GENERADO',cobroTituloBB.tituloActual.codTitulos)}"/>
                                        </p:commandButton>
                                    </f:facet>
                                </h:panelGrid>
                            </p:dialog>
                        </h:panelGrid>

                    </p:outputPanel>
                </h:form>

            </p:panel>
        </h:panelGroup>
    </ui:define>
</ui:composition>
